name: Agentic daily repo report

on:
  schedule:
    # run each day at 09:00 UTC
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  agentic:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run agentic workflow
        uses: github/agentic-workflows@main
        with:
          workflow: |
            # see https://raw.githubusercontent.com/github/gh-aw/main/create.md
            name: daily-report
            description: |
              Gather commits pushed in the last 24 hours, ask an AI agent
              to summarise them, and create an issue containing the summary.
            agents:
              - id: repo-agent
                type: github
            steps:
              - id: gather_commits
                name: collect recent commits
                run: |
                  git log --since="24 hours ago" --oneline > commits.txt
              - id: summarize
                name: generate summary via Python agent
                run: |
                  python agent.py > report.txt
                env:
                  GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
              - id: create_issue
                name: post summary as an issue
                run: |
                  gh issue create \
                    --title "Daily repository activity report – $(date +%F)" \
                    --body-file report.txt
                env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}s